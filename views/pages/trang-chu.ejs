<%- contentFor('body') %>
<!-- Ph·∫ßn t√¨m ki·∫øm -->
<section class="py-4 bg-secondary bg-opacity-10">
<div class="container">
    <div class="mb-3">
      <h5 class="mb-2">T√¨m ki·∫øm</h5>
      <form id="search-form" action="/viec-lam" method="GET">
        <div class="input-group">
          <input type="text" class="form-control" id="search-input" name="keyword" placeholder="T√¨m ki·∫øm theo v·ªã tr√≠, c√¥ng ty..." aria-label="T√¨m ki·∫øm">
          <button class="btn btn-primary" type="submit" id="tim-kiem">
            <i class="fas fa-search"></i> T√¨m ki·∫øm
          </button>
        </div>
      </form>
    </div>
    
    <div class="d-flex flex-wrap align-items-center">
      <span class="text-muted me-2 small">B·ªô l·ªçc t·ªët nh·∫•t:</span>
      <div class="d-flex flex-wrap gap-1">
        <button class="btn btn-sm btn-outline-secondary rounded-pill filter-btn" data-keyword="React">React</button>
        <button class="btn btn-sm btn-outline-secondary rounded-pill filter-btn" data-keyword="Java">Java</button>
        <button class="btn btn-sm btn-outline-secondary rounded-pill filter-btn" data-keyword="JavaScript">JavaScript</button>
        <button class="btn btn-sm btn-outline-secondary rounded-pill filter-btn" data-keyword="UI/UX">UI/UX</button>
        <button class="btn btn-sm btn-outline-secondary rounded-pill filter-btn" data-keyword="C#">C#</button>
        <button class="btn btn-sm btn-outline-secondary rounded-pill filter-btn" data-keyword="DevOps">DevOps</button>
        <button class="btn btn-sm btn-outline-secondary rounded-pill filter-btn" data-keyword="Python">Python</button>
      </div>
    </div>
  </div>
</section>

<!-- C√¥ng Ty N·ªïi B·∫≠t - Ki·ªÉu hi·ªÉn th·ªã m·ªõi -->
<section class="py-4 bg-light">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3 class="text-primary text-center mb-0">C√¥ng Ty N·ªïi B·∫≠t</h3>
    </div>
    
    <!-- Container c√≥ th·ªÉ cu·ªôn ngang v·ªõi ƒëi·ªÅu h∆∞·ªõng -->
    <div class="position-relative">
      <!-- M≈©i t√™n tr√°i -->
      <div class="position-absolute top-50 start-0 translate-middle-y" style="z-index: 10; left: -10px;">
        <button class="btn btn-light rounded-circle shadow-sm" id="scrollLeftBtn">
          <i class="fas fa-chevron-left"></i>
        </button>
    </div>
    
    <!-- Container c√≥ th·ªÉ cu·ªôn ngang -->
    <div class="row flex-nowrap overflow-auto" id="featuredCompaniesContainer" style="-webkit-overflow-scrolling: touch; scroll-behavior: smooth;">
      <% if (typeof featuredCompanies !== 'undefined' && featuredCompanies.length > 0) { %>
        <% featuredCompanies.forEach(function(company) { %>
          <!-- Ki·ªÉm tra th√¥ng tin c√¥ng ty -->
          <% if (company && company.thongTin) { %>
          <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm border">
              <!-- ·∫¢nh n·ªÅn t·ª´ tr∆∞·ªùng anh -->
              <div class="position-relative" style="height: 160px; overflow: hidden;">
                <img src="<%= (company.thongTin && company.thongTin.anh) ? company.thongTin.anh : (defaultBanner || '/images/kg_banner.jpg') %>" 
                    alt="<%= (company.thongTin && company.thongTin.tenCongTy) ? company.thongTin.tenCongTy : 'C√¥ng ty' %>" 
                    class="card-img-top w-100 h-100" 
                    style="object-fit: cover;">
                <div class="position-absolute" style="top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.3);"></div>
              </div>
              
              <div class="card-body">
                <!-- Logo v√† t√™n c√¥ng ty c√πng h√†ng -->
                <div class="d-flex align-items-center mb-3">
                  <img src="<%= (company.thongTin && company.thongTin.logo) ? company.thongTin.logo : (defaultLogo || '/images/kg_logo.jpg') %>" 
                      alt="<%= (company.thongTin && company.thongTin.tenCongTy) ? company.thongTin.tenCongTy : 'Logo' %>" 
                      class="me-3" 
                      style="width: 80px; height: 80px; object-fit: contain;">
                  <div>
                    <h5 class="mb-0"><%= (company.thongTin && company.thongTin.tenCongTy) ? company.thongTin.tenCongTy : 'C√¥ng ty' %></h5>
                    <p class="text-muted small mb-0"><%= (company.thongTin && (company.thongTin.nganhNghe || company.thongTin.linhVuc)) ? (company.thongTin.nganhNghe || company.thongTin.linhVuc) : 'Ch∆∞a c·∫≠p nh·∫≠t' %></p>
                  </div>
                </div>
                
                <!-- M√¥ t·∫£ c√¥ng ty -->
                <p class="small mb-3">
                  <% 
                    let moTa = 'Ch∆∞a c√≥ m√¥ t·∫£ c√¥ng ty.';
                    if (company.thongTin) {
                      if (company.thongTin.moTa) moTa = company.thongTin.moTa;
                      else if (company.thongTin.moTaCty) moTa = company.thongTin.moTaCty;
                    }
                    if (moTa && moTa.length > 100) moTa = moTa.substring(0, 100) + '...';
                  %>
                  <%= moTa %>
                </p>
                <div class="text-center">
                  <a href="/chi-tiet-cong-ty/<%= company._id %>" class="btn btn-sm btn-outline-primary">T√¨m hi·ªÉu th√™m</a>
                </div>
              </div>
            </div>
          </div>
          <% } %>
        <% }); %>
      <% } else { %>
        <!-- Hi·ªÉn th·ªã d·ªØ li·ªáu m·∫´u n·∫øu kh√¥ng c√≥ c√¥ng ty n√†o -->
        <div class="col-md-4 mb-3">
          <div class="card h-100 shadow-sm border">
            <div class="position-relative" style="height: 160px; overflow: hidden;">
              <img src="<%= defaultBanner || '/images/kg_banner.jpg' %>" 
                  alt="C√¥ng ty m·∫´u" 
                  class="card-img-top w-100 h-100" 
                  style="object-fit: cover;">
              <div class="position-absolute" style="top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.3);"></div>
            </div>
            
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <img src="<%= defaultLogo || '/images/kg_logo.jpg' %>" 
                    alt="K&G Technology" 
                    class="me-3" 
                    style="width: 80px; height: 80px; object-fit: contain;">
                <div>
                  <h5 class="mb-0">MB Bank</h5>
                  <p class="text-muted small mb-0">Ng√¢n h√†ng</p>
                </div>
              </div>
              
              <p class="small mb-3">MB l√† ng√¢n h√†ng th∆∞∆°ng m·∫°i h√†ng ƒë·∫ßu Vi·ªát Nam v·ªõi d·ªãch v·ª• t√†i ch√≠nh ƒëa d·∫°ng...</p>
              <div class="text-center">
                <a href="#" class="btn btn-sm btn-outline-primary">T√¨m hi·ªÉu th√™m</a>
              </div>
            </div>
          </div>
        </div>
      <% } %>
    </div>
    
      <!-- M≈©i t√™n ph·∫£i -->
      <div class="position-absolute top-50 end-0 translate-middle-y" style="z-index: 10; right: -10px;">
        <button class="btn btn-light rounded-circle shadow-sm" id="scrollRightBtn">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
    
    <!-- Indicators - ƒë·∫∑t ·ªü gi·ªØa -->
    <div class="d-flex justify-content-center mt-3">
      <button type="button" class="btn btn-sm btn-primary mx-1 active"></button>
      <button type="button" class="btn btn-sm btn-outline-primary mx-1"></button>
      <button type="button" class="btn btn-sm btn-outline-primary mx-1"></button>
    </div>
  </div>
</section>
    
<!-- Nh√† tuy·ªÉn d·ª•ng n·ªïi b·∫≠t -->
<section class="py-4 border-bottom">
  <div class="container">
    <h3 class="text-primary mb-4">Nh√† Tuy·ªÉn D·ª•ng N·ªïi B·∫≠t</h3>
    <div class="position-relative employer-logos">
      <!-- M≈©i t√™n tr√°i -->
      <div class="position-absolute top-50 start-0 translate-middle-y" style="z-index: 10; left: -10px;">
        <button class="btn btn-light rounded-circle shadow-sm" id="prevEmployer">
          <i class="fas fa-chevron-left"></i>
        </button>
      </div>
      
      <!-- Danh s√°ch nh√† tuy·ªÉn d·ª•ng n·ªïi b·∫≠t - L·∫•y t·ª´ database -->
      <div class="d-flex flex-nowrap justify-content-between align-items-center overflow-auto" id="employerLogosContainer" style="-webkit-overflow-scrolling: touch; scroll-behavior: smooth;">
        <% if (typeof featuredEmployers !== 'undefined' && featuredEmployers.length > 0) { %>
          <% featuredEmployers.forEach(function(employer) { %>
            <% if (employer && employer.thongTin) { %>
            <div class="mx-3 my-2">
              <a href="/chi-tiet-cong-ty/<%= employer._id %>">
                <img src="<%= (employer.thongTin && employer.thongTin.logo) ? employer.thongTin.logo : (defaultLogo || '/images/kg_logo.jpg') %>" 
                     alt="<%= (employer.thongTin && employer.thongTin.tenCongTy) ? employer.thongTin.tenCongTy : 'Logo' %>" 
                     height="60" 
                     style="min-width: 150px; object-fit: contain;">
              </a>
            </div>
            <% } %>
          <% }); %>
        <% } else { %>
          <!-- D·ªØ li·ªáu m·∫∑c ƒë·ªãnh n·∫øu kh√¥ng c√≥ nh√† tuy·ªÉn d·ª•ng n·ªïi b·∫≠t trong database -->
        <div class="mx-3 my-2">
            <img src="https://placehold.co/150x60/EEE/31343C?text=PRIME+TECH" alt="PRIME TECH" height="60">
        </div>
        <div class="mx-3 my-2">
            <img src="https://placehold.co/150x60/EEE/31343C?text=MOTOROLA" alt="MOTOROLA" height="60">
        </div>
        <div class="mx-3 my-2">
            <img src="https://placehold.co/150x60/EEE/31343C?text=ROADMAP+AI" alt="ROADMAP AI" height="60">
        </div>
        <div class="mx-3 my-2">
          <img src="https://placehold.co/150x60/EEE/31343C?text=Sacombank" alt="Sacombank" height="60">
        </div>
        <div class="mx-3 my-2">
          <img src="https://placehold.co/150x60/EEE/31343C?text=GEM" alt="GEM" height="60">
        </div>
        <div class="mx-3 my-2">
          <img src="https://placehold.co/150x60/EEE/31343C?text=ACB" alt="ACB" height="60">
        </div>
        <% } %>
      </div>
      
      <!-- M≈©i t√™n ph·∫£i -->
      <div class="position-absolute top-50 end-0 translate-middle-y" style="z-index: 10; right: -10px;">
        <button class="btn btn-light rounded-circle shadow-sm" id="nextEmployer">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Vi·ªác l√†m ƒë√£ l∆∞u -->
<section class="py-4" style="background-color: #d5d5d5;">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3 class="text-primary">Vi·ªác L√†m ƒê√£ L∆∞u</h3>
      <a href="/viec-lam-da-luu" class="text-decoration-none text-primary">XEM T·∫§T C·∫¢</a>
    </div>
    
    <div class="row">
      <% if (typeof savedJobs !== 'undefined' && savedJobs.length > 0) { %>
        <% savedJobs.forEach(function(job) { %>
          <% if (job) { %>
          <div class="col-md-4 mb-3">
            <div class="saved-job-item">
              <div class="job-logo-bg">
                <% 
                  let logoUrl = 'https://placehold.co/150x60/EEE/31343C?text=Logo';
                  if (job.nhaTuyenDung && job.nhaTuyenDung.thongTin && job.nhaTuyenDung.thongTin.logo) {
                    logoUrl = job.nhaTuyenDung.thongTin.logo;
                  }
                %>
                <img src="<%= logoUrl %>" alt="<%= job.nhaTuyenDung && job.nhaTuyenDung.thongTin ? job.nhaTuyenDung.thongTin.tenCongTy : 'Logo c√¥ng ty' %>">
              </div>
              <div class="job-content">
                <h5 class="job-title"><a href="/chi-tiet-cong-viec/<%= job._id %>" class="text-decoration-none text-dark"><%= job.tenCV %></a></h5>
                <p class="company-name"><%= job.nhaTuyenDung && job.nhaTuyenDung.thongTin ? job.nhaTuyenDung.thongTin.tenCongTy : 'Ch∆∞a c·∫≠p nh·∫≠t' %></p>
                <p class="job-location"><%= job.diaDiem || 'Ch∆∞a c·∫≠p nh·∫≠t' %></p>
                <p class="job-salary text-primary"><%= job.luong ? (job.luong/1000000).toFixed(0) + ' tri·ªáu/th√°ng' : 'Th∆∞∆°ng l∆∞·ª£ng' %></p>
              </div>
            </div>
          </div>
          <% } %>
        <% }); %>
      <% } else if (typeof user !== 'undefined' && user) { %>
        <!-- Kh√¥ng c√≥ vi·ªác l√†m ƒë√£ l∆∞u -->
        <div class="col-12 text-center py-5">
          <div class="py-5">
            <i class="far fa-bookmark fa-4x mb-3 text-muted"></i>
            <h5 class="text-muted">B·∫°n ch∆∞a l∆∞u c√¥ng vi·ªác n√†o</h5>
            <p class="text-muted">H√£y kh√°m ph√° c√°c c√¥ng vi·ªác v√† l∆∞u l·∫°i nh·ªØng c√¥ng vi·ªác b·∫°n quan t√¢m</p>
            <a href="/viec-lam" class="btn btn-primary mt-2">T√¨m vi·ªác l√†m ngay</a>
          </div>
        </div>
      <% } else { %>
        <!-- D·ªØ li·ªáu m·∫´u n·∫øu kh√¥ng ƒëƒÉng nh·∫≠p ho·∫∑c kh√¥ng c√≥ d·ªØ li·ªáu -->
        <div class="col-md-4 mb-3">
          <div class="saved-job-item">
            <div class="job-logo-bg">
              <img src="https://placehold.co/150x60/EEE/31343C?text=Logo" alt="Personifeye">
            </div>
            <div class="job-content">
              <h5 class="job-title">Nh√¢n Vi√™n ChƒÉm S√≥c Kh√°ch H√†ng</h5>
              <p class="company-name">C√¥ng Ty CP Th∆∞∆°ng M·∫°i V√† T∆∞ V·∫•n</p>
              <p class="salary-range">10tr-12tr ƒë/th√°ng</p>
              <p class="job-location">H√† N·ªôi</p>
              <p class="job-salary text-primary">Th∆∞∆°ng l∆∞·ª£ng</p>
            </div>
          </div>
        </div>
      <% } %>
    </div>
  </div>
</section>

<!-- C√¥ng vi·ªác hot h√¥m nay -->
<section class="py-4">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="text-primary mb-0">üî• C√¥ng Vi·ªác Hot H√¥m Nay</h3>
      <a href="/cong-viec-hot" class="text-decoration-none">Xem t·∫•t c·∫£</a>
    </div>
    <div class="row">
      <% if (typeof hotJobs !== 'undefined' && hotJobs.length > 0) { %>
        <% hotJobs.forEach(function(job) { %>
          <% if (job) { %>
          <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <% 
                    let logoUrl = 'https://placehold.co/40x40/EEE/31343C?text=Logo';
                    if (job.nhaTuyenDung && job.nhaTuyenDung.thongTin && job.nhaTuyenDung.thongTin.logo) {
                      logoUrl = job.nhaTuyenDung.thongTin.logo;
                    }
                  %>
                  <img src="<%= logoUrl %>" 
                       alt="<%= job.nhaTuyenDung && job.nhaTuyenDung.thongTin ? job.nhaTuyenDung.thongTin.tenCongTy : 'Logo' %>" 
                       height="40" style="object-fit: contain;">
                  <button class="btn btn-sm btn-outline-secondary border-0 btn-bookmark"><i class="far fa-bookmark"></i></button>
                </div>
                <h5 class="mt-3"><a href="/chi-tiet-cong-viec/<%= job._id %>" class="text-decoration-none text-dark"><%= job.tenCV %></a></h5>
                <p class="text-muted small"><%= job.nhaTuyenDung && job.nhaTuyenDung.thongTin ? job.nhaTuyenDung.thongTin.tenCongTy : 'Ch∆∞a c·∫≠p nh·∫≠t' %></p>
                <div class="d-flex flex-wrap mt-3 gap-1">
                  <% if (job.kyNang && job.kyNang.length > 0) { %>
                    <% job.kyNang.forEach(function(skill, index) { %>
                      <% if (index < 5) { %>
                        <span class="badge bg-light text-dark"><%= skill %></span>
                      <% } %>
                    <% }); %>
                  <% } else { %>
                    <span class="badge bg-light text-dark">Ch∆∞a c·∫≠p nh·∫≠t</span>
                  <% } %>
                </div>
                <div class="d-flex justify-content-between mt-3">
                  <span class="text-danger fw-bold"><%= job.luong ? (job.luong/1000000).toFixed(0) + ' tri·ªáu/th√°ng' : 'Th·ªèa thu·∫≠n' %></span>
                  <span class="text-muted small"><%= job.diaDiem || 'Ch∆∞a c·∫≠p nh·∫≠t' %></span>
                </div>
              </div>
            </div>
          </div>
          <% } %>
        <% }); %>
      <% } else { %>
        <!-- Hi·ªÉn th·ªã d·ªØ li·ªáu m·∫´u n·∫øu kh√¥ng c√≥ c√¥ng vi·ªác hot -->
        <div class="col-md-4 mb-3">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <img src="https://placehold.co/40x40/EEE/31343C?text=Prime" alt="Prime Tech" height="40">
                <button class="btn btn-sm btn-outline-secondary border-0 btn-bookmark"><i class="far fa-bookmark"></i></button>
              </div>
              <h5 class="mt-3">Senior Fullstack Developer</h5>
              <p class="text-muted small">PRIME TECH SOLUTION COMPANY LIMITED</p>
              <div class="d-flex flex-wrap mt-3 gap-1">
                <span class="badge bg-light text-dark">Agile</span>
                <span class="badge bg-light text-dark">Java</span>
                <span class="badge bg-light text-dark">Full-Stack</span>
                <span class="badge bg-light text-dark">DevOps</span>
              </div>
              <div class="d-flex flex-wrap mt-2 gap-1">
                <span class="badge bg-light text-dark">ReactJS</span>
                <span class="badge bg-light text-dark">Angular</span>
                <span class="badge bg-light text-dark">Spring Boot</span>
              </div>
            </div>
          </div>
        </div>
      <% } %>
    </div>
    <div class="text-center mt-2">
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1 active">1</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">2</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">3</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">4</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">5</button>
    </div>
  </div>
</section>
    </div>
    <div class="text-center mt-2">
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1 active">1</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">2</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">3</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">4</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">5</button>
            </div>
        </div>
    </section>
    
<!-- C√°c c√¥ng ty n·ªïi b·∫≠t -->
<section class="py-4 bg-light">
  <div class="container">
    <h3 class="text-primary mb-4">C√°c C√¥ng Ty N·ªïi B·∫≠t</h3>
    <div class="row">
      <% if (typeof popularCompanies !== 'undefined' && popularCompanies.length > 0) { %>
        <% popularCompanies.slice(0, 4).forEach(function(company) { %>
          <% if (company && company.thongTin) { %>
          <div class="col-md-3 mb-4">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                  <img src="<%= (company.thongTin && company.thongTin.logo) ? company.thongTin.logo : 'https://placehold.co/40x40/EEE/31343C?text=Logo' %>" height="40" alt="<%= (company.thongTin && company.thongTin.tenCongTy) ? company.thongTin.tenCongTy : 'Logo c√¥ng ty' %>" style="object-fit: contain;">
                  <button class="btn btn-sm btn-outline-secondary border-0 btn-bookmark"><i class="far fa-bookmark"></i></button>
                </div>
                <h5 class="mb-2"><a href="/chi-tiet-cong-ty/<%= company._id %>" class="text-decoration-none text-dark"><%= company.thongTin.tenCongTy || 'C√¥ng ty' %></a></h5>
                <p class="text-muted small mb-2"><%= company.thongTin.nganhNghe || company.thongTin.linhVuc || 'Ch∆∞a c·∫≠p nh·∫≠t' %></p>
                <div class="d-flex flex-wrap mt-3 gap-1">
                  <span class="badge bg-light text-dark"><%= company.thongTin.quyMo || 'Quy m√¥ c√¥ng ty' %></span>
                  <span class="badge bg-light text-dark"><%= company.thongTin.diaChi ? company.thongTin.diaChi.split(',')[0] : 'Vi·ªát Nam' %></span>
                </div>
              </div>
            </div>
          </div>
          <% } %>
        <% }); %>
      <% } else { %>
        <div class="col-md-3 mb-4">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between mb-2">
                <img src="/images/kg_logo.jpg" height="40" alt="IT Support">
                <button class="btn btn-sm btn-outline-secondary border-0"><i class="far fa-bookmark"></i></button>
              </div>
              <h5 class="mb-2">IT Support HN - Authentication (English - Open to Freshers)</h5>
              <p class="text-muted small mb-2">AV VIETNAM CORPORATION</p>
              <div class="d-flex flex-wrap mt-3 gap-1">
                <span class="badge bg-light text-dark">IT Support</span>
                <span class="badge bg-light text-dark">Technical Support</span>
              </div>
            </div>
          </div>
        </div>
      <% } %>
    </div>
  </div>
</section>

<!-- C√¥ng vi·ªác m·ªõi nh·∫•t -->
<section class="py-4 bg-light">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="text-primary mb-0">C√¥ng Vi·ªác M·ªõi Nh·∫•t</h3>
      <a href="/cong-viec-moi" class="text-decoration-none text-danger">Xem t·∫•t c·∫£</a>
    </div>
    <div class="row">
      <% if (typeof latestJobs !== 'undefined' && latestJobs.length > 0) { %>
        <% latestJobs.slice(0, 3).forEach(function(job) { %>
          <% if (job) { %>
          <div class="col-md-4 mb-3">
            <div class="card shadow-sm">
              <div class="card-body">
                <div class="d-flex align-items-center mb-2">
                  <% 
                    let logoUrl = 'https://placehold.co/40x40/EEE/31343C?text=Logo';
                    if (job.nhaTuyenDung && job.nhaTuyenDung.thongTin && job.nhaTuyenDung.thongTin.logo) {
                      logoUrl = job.nhaTuyenDung.thongTin.logo;
                    }
                  %>
                  <img src="<%= logoUrl %>" 
                       alt="<%= job.nhaTuyenDung && job.nhaTuyenDung.thongTin ? job.nhaTuyenDung.thongTin.tenCongTy : 'Logo c√¥ng ty' %>" 
                       class="me-2" 
                       style="width: 40px; height: 40px; object-fit: contain;">
                  <div>
                    <h6 class="mb-0"><a href="/chi-tiet-cong-viec/<%= job._id %>" class="text-decoration-none text-dark"><%= job.tenCV %></a></h6>
                    <small class="text-muted"><%= job.nhaTuyenDung && job.nhaTuyenDung.thongTin ? job.nhaTuyenDung.thongTin.tenCongTy : 'Ch∆∞a c·∫≠p nh·∫≠t' %></small>
                  </div>
                </div>
                <div class="d-flex flex-wrap mt-2 gap-1">
                  <% if (job.kyNang && job.kyNang.length > 0) { %>
                    <% job.kyNang.slice(0, 4).forEach(function(skill) { %>
                      <span class="badge bg-light text-dark"><%= skill %></span>
                    <% }); %>
                  <% } else { %>
                    <span class="badge bg-light text-dark">Ch∆∞a c·∫≠p nh·∫≠t</span>
                  <% } %>
                </div>
                <div class="d-flex justify-content-between mt-3">
                  <span class="text-danger"><%= job.luong ? (job.luong/1000000).toFixed(0) + ' tri·ªáu/th√°ng' : 'Th·ªèa thu·∫≠n' %></span>
                  <span class="text-muted small"><%= job.diaDiem || 'Ch∆∞a c·∫≠p nh·∫≠t' %></span>
                </div>
              </div>
            </div>
          </div>
          <% } %>
        <% }); %>
      <% } else { %>
        <!-- Hi·ªÉn th·ªã d·ªØ li·ªáu m·∫´u n·∫øu kh√¥ng c√≥ c√¥ng vi·ªác n√†o -->
        <div class="col-md-4 mb-3">
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="d-flex align-items-center mb-2">
                <img src="/images/kg_logo.jpg" alt="MB Bank" class="me-2" style="width: 40px; height: 40px; object-fit: contain;">
                <div>
                  <h6 class="mb-0">[Senior] K·ªπ s∆∞ ph√°t tri·ªÉn Mobile App</h6>
                  <small class="text-muted">MB BANK</small>
                </div>
              </div>
              <div class="d-flex flex-wrap mt-2 gap-1">
                <span class="badge bg-light text-dark">Swift</span>
                <span class="badge bg-light text-dark">Java</span>
                <span class="badge bg-light text-dark">React Native</span>
                <span class="badge bg-light text-dark">Kotlin</span>
              </div>
            </div>
          </div>
        </div>
      <% } %>
    </div>
    <div class="text-center mt-2">
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1 active">1</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">2</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">3</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">4</button>
    </div>
  </div>
</section>

<!-- Vi·ªác l√†m g·ª£i √Ω -->
<section class="py-4">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="text-primary mb-0">Vi·ªác L√†m G·ª£i √ù</h3>
      <a href="/viec-lam-goi-y" class="text-decoration-none text-danger">Xem t·∫•t c·∫£</a>
    </div>
    <div class="row">
      <% if (typeof suggestedJobs !== 'undefined' && suggestedJobs.length > 0 && typeof user !== 'undefined' && user) { %>
        <% suggestedJobs.forEach(function(job) { %>
          <% if (job) { %>
          <div class="col-md-4 mb-3">
            <div class="card h-100 border-0 shadow-sm hover-shadow">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <% 
                    let logoUrl = 'https://placehold.co/40x40/EEE/31343C?text=Logo';
                    if (job.nhaTuyenDung && job.nhaTuyenDung.thongTin && job.nhaTuyenDung.thongTin.logo) {
                      logoUrl = job.nhaTuyenDung.thongTin.logo;
                    }
                  %>
                  <img src="<%= logoUrl %>" class="me-2" alt="<%= job.nhaTuyenDung && job.nhaTuyenDung.thongTin ? job.nhaTuyenDung.thongTin.tenCongTy : 'Logo c√¥ng ty' %>" height="40" style="object-fit: contain;">
                  <% if (job.ngayDang && new Date(job.ngayDang).getTime() > Date.now() - 3*24*60*60*1000) { %>
                    <span class="badge bg-danger">M·ªõi</span>
                  <% } else if (job.isHot) { %>
                    <span class="badge bg-warning text-dark">N·ªïi b·∫≠t</span>
                  <% } else { %>
                    <span class="badge bg-primary">Ph√π h·ª£p</span>
                  <% } %>
                </div>
                <h5 class="mt-3"><a href="/chi-tiet-cong-viec/<%= job._id %>" class="text-decoration-none"><%= job.tenCV %></a></h5>
                <p class="text-muted small"><%= job.nhaTuyenDung && job.nhaTuyenDung.thongTin ? job.nhaTuyenDung.thongTin.tenCongTy : 'Ch∆∞a c·∫≠p nh·∫≠t' %></p>
                <div class="d-flex justify-content-between">
                  <span class="text-danger fw-bold"><%= job.luong ? (job.luong/1000000).toFixed(0) + ' tri·ªáu' : 'Th·ªèa thu·∫≠n' %></span>
                  <span class="text-muted small"><%= job.diaDiem || 'Ch∆∞a c·∫≠p nh·∫≠t' %></span>
                </div>
              </div>
            </div>
          </div>
          <% } %>
        <% }); %>
      <% } else { %>
        <!-- Hi·ªÉn th·ªã h∆∞·ªõng d·∫´n ƒëƒÉng nh·∫≠p n·∫øu ch∆∞a ƒëƒÉng nh·∫≠p -->
        <% if (!user) { %>
          <div class="col-12 text-center py-5">
            <div class="py-3">
              <i class="fas fa-user-lock fa-4x mb-3 text-muted"></i>
              <h5 class="text-muted">B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ xem vi·ªác l√†m g·ª£i √Ω</h5>
              <p class="text-muted">Ch√∫ng t√¥i s·∫Ω g·ª£i √Ω c√°c c√¥ng vi·ªác ph√π h·ª£p d·ª±a tr√™n h·ªì s∆° v√† k·ªπ nƒÉng c·ªßa b·∫°n</p>
              <a href="/dang-nhap" class="btn btn-primary mt-2">ƒêƒÉng nh·∫≠p ngay</a>
            </div>
          </div>
        <% } else { %>
          <!-- D·ªØ li·ªáu m·∫´u n·∫øu ƒë√£ ƒëƒÉng nh·∫≠p nh∆∞ng kh√¥ng c√≥ g·ª£i √Ω -->
          <div class="col-md-4 mb-3">
            <div class="card h-100 border-0 shadow-sm hover-shadow">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <img src="/images/kg_logo.jpg" class="me-2" alt="FPT Retail" height="40">
                  <span class="badge bg-danger">M·ªõi</span>
                </div>
                <h5 class="mt-3"><a href="#" class="text-decoration-none">Ch·∫•t l∆∞·ª£ng h·ªá th·ªëng - C√¥ng ngh·ªá th√¥ng tin</a></h5>
                <p class="text-muted small">C√¥ng ty C·ªï ph·∫ßn B√°n l·∫ª K·ªπ thu·∫≠t s·ªë FPT</p>
                <div class="d-flex justify-content-between">
                  <span class="text-danger fw-bold">15-20 tri·ªáu</span>
                  <span class="text-muted small">H√† N·ªôi</span>
                </div>
              </div>
            </div>
          </div>
        <% } %>
      <% } %>
    </div>
    <div class="text-center mt-2">
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1 active">1</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">2</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">3</button>
      <button type="button" class="btn btn-sm btn-outline-secondary mx-1">4</button>
    </div>
  </div>
</section>
        </div>
    </section>

<%- contentFor('extraJS') %>
<script>
  $(document).ready(function() {
    // X·ª≠ l√Ω c√°c h√¨nh ·∫£nh b·ªã l·ªói
    $('img').on('error', function() {
      // Ki·ªÉm tra n·∫øu h√¨nh ·∫£nh ƒë√£ l√† placeholder th√¨ kh√¥ng x·ª≠ l√Ω n·ªØa ƒë·ªÉ tr√°nh v√≤ng l·∫∑p v√¥ h·∫°n
      if (!this.src.includes('placeholder')) {
        if ($(this).width() > 60) {
          // ·∫¢nh l·ªõn
          this.src = '/images/placeholder.jpg';
        } else {
          // Logo ho·∫∑c ·∫£nh nh·ªè
          this.src = '/images/kg_logo.jpg';
        }
      }
    });

    // X·ª≠ l√Ω n√∫t ƒëi·ªÅu h∆∞·ªõng cho ph·∫ßn c√¥ng ty n·ªïi b·∫≠t
    $('#scrollLeftBtn').on('click', function() {
      $('#featuredCompaniesContainer').animate({
        scrollLeft: '-=300'
      }, 300);
    });
    
    $('#scrollRightBtn').on('click', function() {
      $('#featuredCompaniesContainer').animate({
        scrollLeft: '+=300'
      }, 300);
    });
    
    // X·ª≠ l√Ω n√∫t ƒëi·ªÅu h∆∞·ªõng cho ph·∫ßn nh√† tuy·ªÉn d·ª•ng
    $('#prevEmployer').on('click', function() {
      // X·ª≠ l√Ω cu·ªôn danh s√°ch logo c√¥ng ty sang tr√°i
      $('.employer-logos .d-flex').animate({
        scrollLeft: '-=300'
      }, 300);
    });
    
    $('#nextEmployer').on('click', function() {
      // X·ª≠ l√Ω cu·ªôn danh s√°ch logo c√¥ng ty sang ph·∫£i
      $('.employer-logos .d-flex').animate({
        scrollLeft: '+=300'
      }, 300);
    });

    // Fix l·ªói n√∫t bookmark
    $('.btn-bookmark').on('click', function(e) {
      e.preventDefault();
      // Hi·ªÉn th·ªã th√¥ng b√°o ho·∫∑c x·ª≠ l√Ω l∆∞u c√¥ng vi·ªác
      alert('T√≠nh nƒÉng ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn');
    });

    // X·ª≠ l√Ω khi ng∆∞·ªùi d√πng nh·∫•n v√†o c√°c n√∫t b·ªô l·ªçc
    $('.filter-btn').on('click', function() {
      var keyword = $(this).data('keyword');
      $('#search-input').val(keyword);
      $('#search-form').submit();
    });

    console.log('Trang ch·ªß ƒë√£ ƒë∆∞·ª£c t·∫£i v√† kh·ªüi t·∫°o th√†nh c√¥ng');
  });
</script>
